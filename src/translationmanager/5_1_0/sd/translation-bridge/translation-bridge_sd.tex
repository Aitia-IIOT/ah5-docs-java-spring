\documentclass[a4paper]{arrowhead}

\usepackage[yyyymmdd]{datetime}
\usepackage{etoolbox}
\usepackage[utf8]{inputenc}
\usepackage{multirow}

\renewcommand{\dateseparator}{-}

\setlength{\parskip}{1em}
\hyphenation{Er-ror-Res-pon-se}
\hyphenation{Au-thor-i-za-ti-on-Po-li-cy-List-Res-pon-se}

%% Special references
\newcommand{\fref}[1]{{\textcolor{ArrowheadBlue}{\hyperref[sec:functions:#1]{#1}}}}
\newcommand{\mref}[1]{{\textcolor{ArrowheadPurple}{\hyperref[sec:model:#1]{#1}}}}
\newcommand{\prref}[1]{{\textcolor{ArrowheadPurple}{\hyperref[sec:model:primitives:#1]{#1}}}}
\newcommand{\pdef}[1]{{\textcolor{ArrowheadGrey}{#1\label{sec:model:primitives:#1}\label{sec:model:primitives:#1s}\label{sec:model:primitives:#1es}}}}
\newcommand{\pref}[1]{{\textcolor{ArrowheadGrey}{\hyperref[sec:model:primitives:#1]{#1}}}}

\newrobustcmd\fsubsection[5]{
  \addtocounter{subsection}{1}
  \addcontentsline{toc}{subsection}{\protect\numberline{\thesubsection}operation \textcolor{ArrowheadBlue}{#1}}
  \renewcommand*{\do}[1]{\rref{##1},\ }
  \subsection*{
    \thesubsection\quad
    operation
    \textcolor{ArrowheadBlue}{#1}
    (\notblank{#2}{\mref{#2}}{})
    \notblank{#3}{: \mref{#3}}{}
    \notblank{#4}{: \prref{#4}}{}
    \notblank{#5}{/ \mref{#5}}{}
  }
  \label{sec:functions:#1}
}
\newrobustcmd\msubsection[2]{
  \addtocounter{subsection}{1}
  \addcontentsline{toc}{subsection}{\protect\numberline{\thesubsection}#1 \textcolor{ArrowheadPurple}{#2}}
  \subsection*{\thesubsection\quad#1 \textcolor{ArrowheadPurple}{#2}}
  \label{sec:model:#2} \label{sec:model:#2s} \label{sec:model:#2es}
}
\newrobustcmd\msubsubsection[3]{
  \addtocounter{subsubsection}{1}
  \addcontentsline{toc}{subsubsection}{\protect\numberline{\thesubsubsection}#1 \textcolor{ArrowheadPurple}{#2}}
  \subsubsection*{\thesubsubsection\quad#1 \textcolor{ArrowheadPurple}{#2}}
  \label{sec:model:#2} \label{sec:model:#2s}
}
%%

\begin{document}

%% Arrowhead Document Properties
\ArrowheadTitle{translationBridge} % XXX = ServiceName 
\ArrowheadServiceID{translationBridge} % ID name of service
\ArrowheadType{Service Description}
\ArrowheadTypeShort{SD}
\ArrowheadVersion{5.1.0} % Arrowhead version X.Y.Z, e..g. 4.4.1
\ArrowheadDate{\today}
\ArrowheadAuthor{Rajmund Bocsi} % Corresponding author e.g. Jerker Delsing
\ArrowheadStatus{DRAFT} % e..g. RELEASE, RELEASE CONDIDATE, PROTOTYPE
\ArrowheadContact{rbocsi@aitia.ai} % Email of corresponding author
\ArrowheadFooter{\href{www.arrowhead.eu}{www.arrowhead.eu}}
\ArrowheadSetup
%%

%% Front Page
\begin{center}
  \vspace*{1cm}
  \huge{\arrowtitle}

  \vspace*{0.2cm}
  \LARGE{\arrowtype}
  \vspace*{1cm}

  %\Large{Service ID: \textit{"\arrowid"}}
  \vspace*{\fill}

  % Front Page Image
  %\includegraphics{figures/TODO}

  \vspace*{1cm}
  \vspace*{\fill}

  % Front Page Abstract
  \begin{abstract}
    This document provides service description for the \textbf{translationBridge} service. 
  \end{abstract}

  \vspace*{1cm}

%   \scriptsize
%   \begin{tabularx}{\textwidth}{l X}
%     \raisebox{-0.5\height}{\includegraphics[width=2cm]{figures/artemis_logo}} & {ARTEMIS Innovation Pilot Project: Arrowhead\newline
%     THEME [SP1-JTI-ARTEMIS-2012-AIPP4 SP1-JTI-ARTEMIS-2012-AIPP6]\newline
%     [Production and Energy System Automation Intelligent-Built environment and urban infrastructure for sustainable and friendly cities]}
%   \end{tabularx}
%   \vspace*{-0.2cm}
 \end{center}

\newpage
%%

%% Table of Contents
\tableofcontents
\newpage
%%

\section{Overview}
\label{sec:overview}
This document describes the \textbf{translationBridge} service, which enables to find providers whose service operation is accessible by the requester via a translation bridge using the currently available translators and to build/abort such bridges. An example of this interaction is when a consumer system can't find a suitable provider for a specified service operation and try to determine whether it is possible to use one of the providers utilizing various translators.

To enable other systems to use, to consume it, this service needs to be offered through the ServiceRegistry.

The \textbf{translationBridge} service contains the following operations:

\begin{itemize}
    \item \textit{discovery} checks a list of possible providers for a service operation and returns only those that can be consumed by the requester via a translation bridge using the currently available translators;
    \item \textit{negotiation} allows consumers to create a translation bridge to one selected provider's one particular service operation (should be used after a successful discovery but it is possible to do that during the negotiation if no prior discovery is happened);
    \item \textit{abort} aborts an existing bridge created by the requester.
\end{itemize}

The rest of this document is organized as follows.
In Section \ref{sec:functions}, we describe the abstract message operations provided by the service.
In Section \ref{sec:model}, we end the document by presenting the data types used by the mentioned operations.

\subsection{How This Service Is Meant to Be Used}

This service should be used by a consumer system in Local Clouds where simple rule-based service orchestration is available or there is no service orchestration at all.

Consumer systems should call the \textit{discovery} operation with "almost good" service instance candidates that comes from the Service Registry. "Almost good" means that these candidates provides the required service operation but the direct communication is not possible because of missing common interfaces and/or different data models. Operation \textit{discovery} returns the identifiers those candidates that can be accessed by the consumer via a translation bridge alongside with an identifier.

Consumer systems then should call the \textit{negotiation} operation with the above-mentioned identifier and one of the candidates and the operation builds the translation bridge (based on the data collected during the \textit{discovery}) and return its access information.

Please note that it is possible to use the \textit{negotiation} operation without using the \textit{discovery} operation first. In that case consumer can't provide the identifier mentioned before, but needs to specify additional requirements. If no identifier is provided, the \textit{negotiation} automatically executes the \textit{discovery} operation on that one candidate that is specified before trying to build a translation bridge.

After the consumer has finished the work with the translation bridge, it should call the \textit{abort} to eliminate the bridge and free up resources.

\subsection{Important Delimitations}
\label{sec:delimitations}

The requester has to identify itself to use any of the operations.

\subsection{Access policy}
\label{sec:accesspolicy}

Available for anyone within the Local Cloud.

\newpage

\section{Service Operations}
\label{sec:functions}

This section describes the abstract signatures of each operations of the service. In particular, each subsection names an operation, an input type and one or two output types (unsuccessful operations can return different structure), in that order.
The input type is named inside parentheses, while the output type is preceded by a colon. If the operation has two output types, they are separated by a slash.
Input and output types are only denoted when accepted or returned, respectively, by the operation in question. All abstract data types named in this section are defined in Section 3.

\phantomsection
\fsubsection{discovery}{TranslationDiscoveryRequest}{TranslationDiscoveryResponse}{}{ErrorResponse}

Operation \textit{discovery} checks a list of possible providers for a service operation and returns only those that can be consumed by the requester via a translation bridge using the currently available translators. The request data must meet the following criteria:

\begin{itemize}
    \item With this operation the requester can only found good candidates to accessing one of their service operation via a translation bridge for itself. 
    \item The target operation is mandatory and must follow the kebab-case naming convention.  Operation can contain maximum 63 characters of letters (English alphabet) and numbers, and have to start with a letter.
    \item Interface template name list is mandatory and can not be empty. Every interface template name must follow the snake\_case naming convention, can contain maximum 63 characters of lower-case letters (English alphabet) and numbers, and have to start with a letter.
    \item Candidates list is mandatory can not be empty. Every candidate has to specify its service instance id, provider's name, service definition name and information about its interfaces:
    \begin{itemize}
        \item Service instance id must be a valid \pref{ServiceInstanceID}.
        \item Provider's name must follow the PascalCase naming convention, can contain maximum of 63 characters of letters (English alphabet) and numbers, and have to start with a letter.
        \item Service definition must follow the camelCase naming convention can contain maximum of 63 characters of letters (English alphabet) and numbers, and have to start with a letter.
        \item Interface list can not be empty and its every element must meet the following criteria:
        \begin{itemize}
            \item Template name is mandatory and must follow the snake\_case naming convention, can contain maximum 63 characters of lower-case letters (English alphabet) and numbers, and have to start with a letter.
            \item Policy is mandatory and must be a valid \pref{SecurityPolicy}.
            \item Properties must contain a structure that is a valid \hyperref[sec:model:DataModelMap]{DataModelMap} which contains an entry for the specified operation. This is not necessary for operations without any input or output payload.
            \item Properties must contain every interface-dependent information that is necessary for access (for example, address, port, path, topic, etc.).
        \end{itemize}
    \end{itemize}
\end{itemize}

\fsubsection{negotiation}{TranslationNegotiationRequest}{TranslationNegotiationResponse}{}{ErrorResponse}

Operation \textit{negotiation} allows consumers to create a translation bridge to one selected provider's one particular service operation. The request data must meet the following criteria:

\begin{itemize}
    \item Target is mandatory.
    \item If bridge identifier is specified only the service instance identifier of the target is necessary.
    \item In either case, service instance identifier is mandatory and  must be a valid \pref{ServiceInstanceID}.
    \item If bridge identifier is missing, a \textit{discovery} operation is automatically called before the negotiation steps where the only candidate is the target. That means target must meet the criteria about candidates mentioned at operation \textit{discovery}. 
    \item The same is true in the case of operation and interface template names parameters.
\end{itemize}

\fsubsection{abort}{TranslationAbortRequest}{}{OperationStatus}{ErrorResponse}

Operation \textit{abort} aborts an existing bridge. The abort data must meet the following criteria:

\begin{itemize}
    \item The bridge identifier is mandatory.
    \item Requester can only abort translation bridges that was created by its request.
\end{itemize}

\clearpage

\section{Information Model}
\label{sec:model}

Here, all data objects that can be part of the \textbf{translationBridge} service are listed and must be respected by the hosting system.
Note that each subsection, which describes one type of object, begins with the \textit{struct} keyword, which is used to denote a collection of named fields, each with its own data type.
As a complement to the explicitly defined types in this section, there is also a list of implicit primitive types in Section \ref{sec:model:primitives}, which are used to represent things like hashes and identifiers.

\msubsection{struct}{TranslationDiscoveryRequest}
 
\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{3.9cm} | p{6.2cm} | p{1.3cm} | X |} \hline
\rowcolor{gray!33} Field & Type & Mandatory & Description \\ \hline
authentication &\hyperref[sec:model:Identity]{Identity} & yes & The requester of the operation. \\ \hline
candidates & \pref{List}$<$\hyperref[sec:model:TranslationDiscoveryServiceInstanceDescriptor]{Translation\-Discovery\-Service\-Instance\-Descriptor}$>$ & yes & Possible service instances for con\-sum\-ing via a translation bridge. \\ \hline
operation & \pref{ServiceOperationName} & yes & The operation that the requester wants to consume. \\ \hline
interfaceTemplateNames & \pref{List}$<$\pref{InterfaceName}$>$ & yes & The name of the interfaces that the consumer can use. \\ \hline
inputDataModelId & \pref{DataModelIdentifier} & yes (no) & The identifier of the data model that the specified operation uses as input payload. Must be omitted if there is no input payload. \\ \hline
outputDataModelId & \pref{DataModelIdentifier} & yes (no) & The identifier of the data model that the specified operation uses as response payload. Must be omitted if there is no res\-ponse payload. \\ \hline
\end{tabularx}
\end{table}

\msubsection{struct}{Identity}

An \pref{Object} which describes the identity of a system. It also contains whether the identified system has higher level administrative rights.

\msubsection{struct}{TranslationDiscoveryServiceInstanceDescriptor}

\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{3.9cm} | p{6.2cm} | p{2cm} | X |} \hline
\rowcolor{gray!33} Field & Type & Mandatory & Description \\ \hline
instanceId & \pref{ServiceInstanceID} & yes & Unique identifier of the service instance. \\ \hline
provider & \hyperref[sec:model:TranslationDiscoverySystemDescriptor]{Translation\-Discovery\-System\-Descriptor} & yes & Provider system. \\ \hline
serviceDefinition & \hyperref[sec:model:TranslationDiscoveryServiceDefinitionDescriptor]{Translation\-Discovery\-Service\-Definition\-Descriptor} & yes & Service definition. \\ \hline
\end{tabularx}
\end{table}
\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{3.9cm} | p{6.2cm} | p{2cm} | X |} \hline
interfaces & \pref{List}$<$\hyperref[sec:model:TranslationDiscoveryServiceInstanceInterfaceDescriptor]{Translation\-Discovery\-Service\-Instance\-Interface\-Descriptor}$>$ & yes & Available access interfaces of the service instance. \\ \hline
\end{tabularx}
\end{table}

\msubsection{struct}{TranslationDiscoverySystemDescriptor}

\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{3.9cm} | p{4cm} | p{2cm} | X |} \hline
\rowcolor{gray!33} Field & Type & Mandatory & Description \\ \hline
name & \pref{SystemName} & yes & Unique name of the system. \\ \hline
\end{tabularx}
\end{table}

\msubsection{struct}{TranslationDiscoveryServiceDefinitionDescriptor}

\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{3.9cm} | p{4cm} | p{2cm} | X |} \hline
\rowcolor{gray!33} Field & Type & Mandatory & Description \\ \hline
name & \pref{ServiceName} & yes & Unique name of the service definition. \\ \hline
\end{tabularx}
\end{table}

\msubsection{struct}{TranslationDiscoveryServiceInstanceInterfaceDescriptor}

\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{3.9cm} | p{4cm} | p{2cm} | X |} \hline
\rowcolor{gray!33} Field & Type & Mandatory & Description \\ \hline
templateName & \pref{InterfaceName} & yes & The name of the interface template that describes the interface structure. \\ \hline
policy & \pref{SecurityPolicy} & yes & The security of the interface. \\ \hline
properties &\hyperref[sec:model:Metadata]{Metadata} & yes & Interface template-specific data. \\ \hline
\end{tabularx}
\end{table}

\msubsection{struct}{Metadata}

An \pref{Object} which maps \pref{String} keys to primitive, \pref{Object} or list values.

\msubsection{struct}{TranslationDiscoveryResponse}

\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{4.25cm} | p{6.1cm} | X |} \hline
\rowcolor{gray!33} Field & Type      & Description \\ \hline
status & \pref{OperationStatus} & Status of the operation. \\ \hline
bridgeId & \pref{BridgeIdentifier} & Unique identifier related to discovery results \\ \hline
candidates & \pref{List}$<$\hyperref[sec:model:TranslationBridgeCandidate]{TranslationBridgeCandidate}$>$ & Information about service instances that can be accessed via a translation bridge. \\ \hline
\end{tabularx}
\end{table}

\clearpage

\msubsection{struct}{TranslationBridgeCandidate}

\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{4.25cm} | p{6.1cm} | X |} \hline
\rowcolor{gray!33} Field & Type      & Description \\ \hline
serviceInstanceId & \pref{ServiceInstanceID} & Unique identifier of the service instance. \\ \hline
interfaceTemplateName & \pref{InterfaceName} & Name of the interface that can be used to access the specified operation of the service instance. \\ \hline
\end{tabularx}
\end{table}

\msubsection{struct}{ErrorResponse}

\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{4.25cm} | p{3.5cm} | X |} \hline
\rowcolor{gray!33} Field & Type      & Description \\ \hline
status & \pref{OperationStatus} & Status of the operation. \\ \hline
errorMessage & \pref{String} & Description of the error. \\ \hline
errorCode &\pref{Number}  & Numerical code of the error. \\ \hline
type & \pref{ErrorType} & Type of the error. \\ \hline
origin & \pref{String} & Origin of the error. \\ \hline
\end{tabularx}
\end{table}

\msubsection{struct}{DataModelMap}

An \pref{Object} that maps the key \textit{dataModels} to an \pref{Object}, in which keys are \pref{ServiceOperationName}s and the values are \pref{Object}s containing \pref{DataModelIdentifier}s using keys \textit{input} and \textit{output}. If an operation has input payload then the identifier of the input data model is assigned to the key \textit{input}. If the operation has response payload then the identifier of the response data model is assigned to the key \textit{output}. If an operation has no input and/or response payload, the appropriate key-value pair must be omitted. If an operation has no payload at all, then that operation can be omitted from the structure.

Should looks like this:
\begin{verbatim}
        dataModels: { 
            <operation name>: { 
                input: <input data model id> 
                output: <output data model id>
            } 
        }
\end{verbatim}

\clearpage

\msubsection{struct}{TranslationNegotiationRequest}
 
\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{3.9cm} | p{6.2cm} | p{1.3cm} | X |} \hline
\rowcolor{gray!33} Field & Type & Mandatory & Description \\ \hline
authentication & \hyperref[sec:model:Identity]{Identity} & yes & The requester of the operation. \\ \hline
bridgeId & \pref{BridgeIdentifier} & no & The unique identifier of the results of a previously executed discovery operation. \\ \hline
target & \hyperref[sec:model:TranslationNegotiationServiceInstanceDescriptor]{Translation\-Negotiation\-Service\-Instance\-Descriptor}$>$ & yes & Information about the target service instance. \\ \hline
operation & \pref{ServiceOperationName} & no (yes) & The operation that the requester wants to consume. Mandatory if bridgeId is not specified. \\ \hline
interfaceTemplateName & \pref{InterfaceName} & no (yes) & The name of the interface that the consumer can use. Mandatory if bridgeId is not specified \\ \hline
inputDataModelId & \pref{DataModelIdentifier} & no (yes) & The identifier of the data model that the target operation uses as input payload. Can be omitted if bridgeId is specified and must be omitted if there is no input payload. \\ \hline
outputDataModelId & \pref{DataModelIdentifier} & no (yes) & The identifier of the data model that the target operation uses as response payload. Can be omitted if bridgeId is specified and must be omitted if there is no res\-ponse payload. \\ \hline
\end{tabularx}
\end{table}

\msubsection{struct}{TranslationNegotiationServiceInstanceDescriptor}

\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{3.9cm} | p{6.2cm} | p{2cm} | X |} \hline
\rowcolor{gray!33} Field & Type & Mandatory & Description \\ \hline
instanceId & \pref{ServiceInstanceID} & yes & Unique identifier of the service instance. \\ \hline
provider & \hyperref[sec:model:TranslationDiscoverySystemDescriptor]{Translation\-Discovery\-System\-Descriptor} & no (yes) & Provider system. Mandatory if the bridgeId is not specified in the containing model. \\ \hline
serviceDefinition & \hyperref[sec:model:TranslationDiscoveryServiceDefinitionDescriptor]{Translation\-Discovery\-Service\-Definition\-Descriptor} & no (yes) & Service definition.  Mandatory if the bridgeId is not specified in the containing model. \\ \hline
interfaces & \pref{List}$<$\hyperref[sec:model:TranslationDiscoveryServiceInstanceInterfaceDescriptor]{Translation\-Discovery\-Service\-Instance\-Interface\-Descriptor}$>$ & no (yes) & Available access interfaces of the service instance.  Mandatory if the bridgeId is not specified in the containing model. \\ \hline
\end{tabularx}
\end{table}

\subsection{Primitives}
\label{sec:model:primitives}

Types and structures mentioned throughout this document that are assumed to be available to implementations of this service.
The concrete interpretations of each of these types and structures must be provided by any IDD document claiming to implement this service.


\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{5cm} | X |} \hline
\rowcolor{gray!33} Type & Description \\ \hline
\pdef{AuthorizationLevel} & String identifier that specifies whether a rule is created by a provider for its service instances/event types (provider-level) or a higher entity does that (management-level). \\ \hline
\pdef{AuthorizationPolicyInstanceID} & A composite string identifier that is intended to be both human and machine-readable. It consists of the instance's level (provider or management), cloud identifier, provider name, target type and target, each separated by a special delimiter character. Each part must follow its related naming convention. \\ \hline
\pdef{AuthorizationPolicyType} & String identifier of the various policy types: for whitelist-based policy, for blacklist-based policy, for cloud-level policy and for system-level metadata-based policy. \\ \hline
\pdef{AuthorizationTargetType} & String identifiers that specifies whether a rule is about a service instance or an event type. \\ \hline
\pdef{Boolean}          & One out of true or false. \\ \hline
\pdef{CloudIdentifier} & A composite string identifier that is intended to be both human and machine-readable. It consists of the cloud name and the organization name that is managing the cloud. Each part must follow the PascalCase naming convention. \\ \hline
\pdef{DateTime}         & Pinpoints a specific moment in time. \\ \hline
\pdef{ErrorType}        & Any suitable type chosen by the implementor of service. \\ \hline
\pdef{EventTypeName}      & A string identifier that is intended to be both human and machine-readable. Must follow camelCase naming convention. \\ \hline
\pdef{List}$<$A$>$      & An \textit{array} of a known number of items, each having type A. \\ \hline
\pdef{Number}           & Decimal number. \\ \hline
\end{tabularx}
\end{table}

\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{5cm} | X |} \hline
\rowcolor{gray!33} Type & Description \\ \hline
\pdef{Object}           & Set of primitives and possible further objects. \\ \hline
\pdef{OperationStatus}  & Logical, textual or numerical value that indicates whether an operation is a success or a failure. Multiple values can be used for success and error cases to give additional information about the nature of the result. \\ \hline
\pdef{ServiceName}      & A string identifier that is intended to be both human and machine-readable. Must follow camelCase naming convention. \\ \hline
\pdef{ServiceOperationName} & A string identifier that is intended to be both human and machine-readable. Must follow kebab-case naming convention. \\ \hline
\pdef{String}           & A chain of characters. \\ \hline
\pdef{SystemName}       & A string identifier that is intended to be both human and machine-readable. Must follow PascalCase naming convention. \\ \hline
\end{tabularx}
\end{table}

\newpage

\bibliographystyle{IEEEtran}
\bibliography{bibliography}

\newpage

\section{Revision History}
\subsection{Amendments}

\noindent\begin{tabularx}{\textwidth}{| p{1cm} | p{3cm} | p{2cm} | X | p{4cm} |} \hline
\rowcolor{gray!33} No. & Date & Version & Subject of Amendments & Author \\ \hline

1 & YYYY-MM-DD & \arrowversion & & Xxx Yyy \\ \hline
\end{tabularx}

\subsection{Quality Assurance}

\noindent\begin{tabularx}{\textwidth}{| p{1cm} | p{3cm} | p{2cm} | X |} \hline
\rowcolor{gray!33} No. & Date & Version & Approved by \\ \hline

1 & YYYY-MM-DD & \arrowversion  &  \\ \hline

\end{tabularx}

\end{document}