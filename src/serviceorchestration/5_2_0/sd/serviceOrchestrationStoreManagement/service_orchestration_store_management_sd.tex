\documentclass[a4paper]{arrowhead}

\usepackage[yyyymmdd]{datetime}
\usepackage{etoolbox}
\usepackage[utf8]{inputenc}
\usepackage{multirow}

\renewcommand{\dateseparator}{-}

\setlength{\parskip}{1em}
\hyphenation{Er-ror-Res-pon-se}

%% Special references
\newcommand{\fref}[1]{{\textcolor{ArrowheadBlue}{\hyperref[sec:functions:#1]{#1}}}}
\newcommand{\mref}[1]{{\textcolor{ArrowheadPurple}{\hyperref[sec:model:#1]{#1}}}}
\newcommand{\prref}[1]{{\textcolor{ArrowheadPurple}{\hyperref[sec:model:primitives:#1]{#1}}}}
\newcommand{\pdef}[1]{{\textcolor{ArrowheadGrey}{#1\label{sec:model:primitives:#1}\label{sec:model:primitives:#1s}\label{sec:model:primitives:#1es}}}}
\newcommand{\pref}[1]{{\textcolor{ArrowheadGrey}{\hyperref[sec:model:primitives:#1]{#1}}}}

\newrobustcmd\fsubsection[5]{
  \addtocounter{subsection}{1}
  \addcontentsline{toc}{subsection}{\protect\numberline{\thesubsection}operation \textcolor{ArrowheadBlue}{#1}}
  \renewcommand*{\do}[1]{\rref{##1},\ }
  \subsection*{
    \thesubsection\quad
    operation
    \textcolor{ArrowheadBlue}{#1}
    (\notblank{#2}{\mref{#2}}{})
    \notblank{#3}{: \mref{#3}}{}
    \notblank{#4}{: \prref{#4}}{}
    \notblank{#5}{/ \mref{#5}}{}
  }
  \label{sec:functions:#1}
}
\newrobustcmd\msubsection[2]{
  \addtocounter{subsection}{1}
  \addcontentsline{toc}{subsection}{\protect\numberline{\thesubsection}#1 \textcolor{ArrowheadPurple}{#2}}
  \subsection*{\thesubsection\quad#1 \textcolor{ArrowheadPurple}{#2}}
  \label{sec:model:#2} \label{sec:model:#2s} \label{sec:model:#2es}
}
\newrobustcmd\msubsubsection[3]{
  \addtocounter{subsubsection}{1}
  \addcontentsline{toc}{subsubsection}{\protect\numberline{\thesubsubsection}#1 \textcolor{ArrowheadPurple}{#2}}
  \subsubsection*{\thesubsubsection\quad#1 \textcolor{ArrowheadPurple}{#2}}
  \label{sec:model:#2} \label{sec:model:#2s}
}
%%

\begin{document}

%% Arrowhead Document Properties
\ArrowheadTitle{serviceOrchestrationStoreManagement} % XXX = ServiceName 
\ArrowheadServiceID{serviceOrchestrationStoreManagement} % ID name of service
\ArrowheadType{Service Description}
\ArrowheadTypeShort{SD}
\ArrowheadVersion{5.2.0} % Arrowhead version X.Y.Z, e..g. 4.4.1
\ArrowheadDate{\today}
\ArrowheadAuthor{Katinka Jak√≥} % Corresponding author e.g. Jerker Delsing
\ArrowheadStatus{DRAFT} % e..g. RELEASE, RELEASE CONDIDATE, PROTOTYPE
\ArrowheadContact{jako.katinka@aitia.ai} % Email of corresponding author
\ArrowheadFooter{\href{www.arrowhead.eu}{www.arrowhead.eu}}
\ArrowheadSetup
%%

%% Front Page
\begin{center}
  \vspace*{1cm}
  \huge{\arrowtitle}

  \vspace*{0.2cm}
  \LARGE{\arrowtype}
  \vspace*{1cm}

  %\Large{Service ID: \textit{"\arrowid"}}
  \vspace*{\fill}

  % Front Page Image
  %\includegraphics{figures/TODO}

  \vspace*{1cm}
  \vspace*{\fill}

  % Front Page Abstract
  \begin{abstract}
    This document provides service description for the \textbf{serviceOrchestrationStoreManagement} service. 
  \end{abstract}

  \vspace*{1cm}

%   \scriptsize
%   \begin{tabularx}{\textwidth}{l X}
%     \raisebox{-0.5\height}{\includegraphics[width=2cm]{figures/artemis_logo}} & {ARTEMIS Innovation Pilot Project: Arrowhead\newline
%     THEME [SP1-JTI-ARTEMIS-2012-AIPP4 SP1-JTI-ARTEMIS-2012-AIPP6]\newline
%     [Production and Energy System Automation Intelligent-Built environment and urban infrastructure for sustainable and friendly cities]}
%   \end{tabularx}
%   \vspace*{-0.2cm}
 \end{center}

\newpage
%%

%% Table of Contents
\tableofcontents
\newpage
%%

\section{Overview}
\label{sec:overview}
This document describes the \textbf{serviceOrchestrationStoreManagement} service, which enables systems with administrative rights to manage the peer-to-peer orchestration rules within an Eclipse Arrowhead Local Cloud (LC). These rules associate consumer systems to service instances and can be used during orchestration process in case of simple-store strategy.


The \textbf{serviceOrchestrationStoreManagement} service contains the following operations:

\begin{itemize}
    \item \textit{query} lists the stored rules that match the filtering requirements;
    \item \textit{create} adds new orchestration rules to the LC in bulk;
    \item \textit{modify-priorities} updates the priority of the given rules in bulk;
    \item \textit{remove} removes stored orchestration rules in bulk.
\end{itemize}

The rest of this document is organized as follows.
In Section \ref{sec:functions}, we describe the abstract message operations provided by the service.
In Section \ref{sec:model}, we end the document by presenting the data types used by the mentioned operations.

\subsection{How This Service Is Meant to Be Used}

This service can be used to define peer-to-peer rules that determine the orchestration in a Local Cloud that uses simple-store strategy. These rules associate a consumer system with a service instance identifier. Each rule has a priority, and higher-priority rules appear earlier in the orchestration results. Priority is the only attribute that can be modified in a rule.

\subsection{Important Delimitations}
\label{sec:delimitations}

The consumer has to identify itself to use any of the operations.

\subsection{Access policy}
\label{sec:accesspolicy}

The service is only available for operators, dedicated Core/Support systems and those who have the proper authorization rights to consume it.

\newpage

\section{Service Operations}
\label{sec:functions}

This section describes the abstract signatures of each operations of the service. The \textbf{serviceOrchestrationStoreManagement} service is used to perform \textit{query, create, modify-priorities} and \textit{remove} operations on orchestration rules.
In particular, each subsection names an operation, an input type and one or two output types (unsuccessful operations can return different structure), in that order.
The input type is named inside parentheses, while the output type is preceded by a colon. If the operation has two output types, they are separated by a slash.
Input and output types are only denoted when accepted or returned, respectively, by the operation in question. All abstract data types named in this section are defined in Section 3.

\phantomsection
\fsubsection{query}{OrchestrationSimpleStoreQueryRequest}{OrchestrationSimpleStoreListResponse}{}{ErrorResponse}

Operation query lists the orchestration store records that match the filtering requirements. The query data must meet the following criteria:

\begin{itemize}
    \item The operation returns results in pages. There are default page data settings, but the requester can provide a custom specification.
    \item If page number is specified, the page size must be specified as well and vice versa.
    \item In some Local Clouds there is a maximum page size.
    \item If a filter expects a list, there is an OR relation between the elements of the filter.
    \item There is an AND relation between different kind of filters
\end{itemize}

\fsubsection{create}{OrchestrationSimpleStoreListRequest}{OrchestrationSimpleStoreListResponse}{}{ErrorResponse}

This operation requires at least the consumer's identity and the orchestration store entries to create. The result of this operation is a list of rules that were created. It is not allowed to store rules where the consumer system name, service instance identifier and priority all have the same value as in another rule.

\fsubsection{modify-priorities}{PriorityRequest}{OrchestrationSimpleStoreListResponse}{}{ErrorResponse}

This operation requires at least the consumer's identity and the rule identifiers with their new priorities. The result of this operation is a list of all the rules referenced by the identifiers after the update (even if they were not actually modified). When specifying priorities, care must be taken to ensure that the rules remain unique according to consumer system name, service instance identifier and priority.

\fsubsection{remove}{OrchestrationSimpleStoreRemoveRequest}{OperationStatus}{}{ErrorResponse}

Operation \textit{remove} requires the rule identifiers and removes their associated store orchestration records.

\clearpage

\section{Information Model}
\label{sec:model}

Here, all data objects that can be part of the \textbf{serviceOrchestration} service are listed and must be respected by the hosting System.
Note that each subsection, which describes one type of object, begins with the \textit{struct} keyword, which is used to denote a collection of named fields, each with its own data type.
As a complement to the explicitly defined types in this section, there is also a list of implicit primitive types in Section \ref{sec:model:primitives}, which are used to represent things like hashes and identifiers.

% OrchestrationSimpleStoreQueryRequest %
\phantomsection
\msubsection{struct}{OrchestrationSimpleStoreQueryRequest}
 
\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{3cm} | p{3.75cm} | p{1.75cm} | X |} \hline
\rowcolor{gray!33} Field & Type & Mandatory & Description \\ \hline
pagination & \hyperref[sec:model:PageRequest]{PageRequest} & yes & Paging information about the queried store records. \\ \hline
ids & \pref{List}$<$\pref{StoreEntryID}$>$ & no (yes) & Requester is looking for store entries with any of the specified identifiers. \\ \hline
consumerNames & \pref{List}$<$\pref{SystemName}$>$ & no (yes) & Requester is looking for store entries with any of the consumer system names. \\ \hline
serviceDefinitions & \pref{List}$<$\pref{ServiceName}$>$ & no (yes) & Requester is looking for store entries with any of the specified service definition names.  \\ \hline
serviceInstanceIds & \pref{List}$<$\pref{ServiceInstanceID}$>$ & no (yes) & Requester is looking for store entries with any of the specified service instance identifiers. \\ \hline
minPriority & \pref{Number} & no & Requester is looking for store entries with at least the specified priority.  \\ \hline
maxPriority & \pref{Number} & no & Requester is looking for store entries with at most the specified priority.  \\ \hline
createdBy & \pref{SystemName} & no (yes) & Requester is looking for store entries that were created by a system with the specified name. \\ \hline
\end{tabularx}
\end{table}

\textbf{\textit{Note}}: One of the following fields must be specified: \textit{ids, consumerNames, serviceDefinitions, serviceInstanceIds} or \textit{createdBy}.

\msubsection{struct}{PageRequest}

\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{2.5cm} | p{2.5cm} | p{2cm} | X |} \hline
\rowcolor{gray!33} Field & Type & Mandatory & Description \\ \hline
authentication & \hyperref[sec:model:Identity]{Identity} & yes & The requester of the operation. \\ \hline
pageNumber & \pref{Number} & no (yes) & The number of the requested page. It is mandatory, if page size is specified. \\ \hline
pageSize & \pref{Number} & no (yes) & The number of entries on the requested page. It is mandatory, if page number is specified. \\ \hline
pageSortField & \pref{String} & no & The identifier of the field which must be used to sort the entries. \\ \hline
pageDirection & \pref{Direction} & no & The direction of the sorting. \\ \hline
\end{tabularx}
\end{table}

% OrchestrationSimpleStoreListResponse %

\msubsection{struct}{OrchestrationSimpleStoreListResponse}

\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{1.5cm} | p{7cm} | X |} \hline
\rowcolor{gray!33} Field & Type      & Description \\ \hline
status & \pref{OperationStatus} & Status of the operation. \\ \hline
entries & \pref{List}$<$\hyperref[sec:model:OrchestrationSimpleStoreResponse]{OrchestrationSimpleStoreResponse}$>$ & A page of store entries. \\ \hline
count & \pref{Number} & Total number of store entries that match the filters. \\ \hline
\end{tabularx}
\end{table}

% OrchestrationSimpleStoreResponse %

\msubsection{struct}{OrchestrationSimpleStoreResponse}

\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{3cm} | p{3cm} | X |} \hline
\rowcolor{gray!33} Field & Type      & Description \\ \hline
id & \pref{StoreEntryID} & Unique identifier of the store entry. \\ \hline
consumer & \pref{SystemName} & Name of the consumer system that the rule applies to. \\ \hline
serviceDefinition & \pref{ServiceName} & Name of the service definition that the rule applies to. \\ \hline
serviceInstanceId & \pref{ServiceInstanceID} & Identifier of the service instance that the rule applies to. \\ \hline
priority & \pref{Number} & Priority of the rule.  \\ \hline
createdBy & \pref{SystemName} &  The rule was created by this system. \\ \hline
updatedBy & \pref{SystemName} &  The rule was updated by this system. \\ \hline
createdAt & \pref{DateTime} & The rule was created at this timestamp. \\ \hline
updatedAt & \pref{DateTime} & The rule was last updated at this timestamp. \\ \hline
\end{tabularx}
\end{table}

% ErrorResponse %

\msubsection{struct}{ErrorResponse}

\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{4.25cm} | p{3.5cm} | X |} \hline
\rowcolor{gray!33} Field & Type      & Description \\ \hline
status & \pref{OperationStatus} & Status of the operation. \\ \hline
errorMessage & \pref{String} & Description of the error. \\ \hline
errorCode &\pref{Number}  & Numerical code of the error. \\ \hline
type & \pref{ErrorType} & Type of the error. \\ \hline
origin & \pref{String} & Origin of the error. \\ \hline
\end{tabularx}
\end{table}

% OrchestrationSimpleStoreListRequest %

\msubsection{struct}{OrchestrationSimpleStoreListRequest}

\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{2.5cm} | p{6.75cm} | p{2cm} | X |} \hline
\rowcolor{gray!33} Field & Type & Mandatory & Description \\ \hline
authentication & \hyperref[sec:model:Identity]{Identity} & yes & The requester of the operation. \\ \hline
entries & \pref{List}$<$\hyperref[sec:model:OrchestrationSimpleStoreRequest]{OrchestrationSimpleStoreRequest}$>$ & yes & A list of store entries to create. \\ \hline
\end{tabularx}
\end{table}

\msubsection{struct}{Identity}

An \pref{Object} which describes the identity of a system. It also contains whether the identified system has higher level administrative rights.

\msubsection{struct}{OrchestrationSimpleStoreRequest}

\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{3.25cm} | p{3.5cm} | p{2cm} | X |} \hline
\rowcolor{gray!33} Field & Type & Mandatory & Description \\ \hline
consumer & \pref{SystemName} & yes & The name of the consumer system that the rule applies to. \\ \hline
serviceInstanceId & \pref{ServiceInstanceID} & yes & The name of the service instance identifier that the rule applies to. \\ \hline
priority & \pref{Number} & yes & The priority of the rule.  \\ \hline
\end{tabularx}
\end{table}

% OrchestrationSimpleStorePriorityRequest %

\msubsection{struct}{OrchestrationSimpleStorePriorityRequest}

\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{3.25cm} | p{3.5cm} | p{2cm} | X |} \hline
\rowcolor{gray!33} Field & Type & Mandatory & Description \\ \hline
authentication & \hyperref[sec:model:Identity]{Identity} & yes & The requester of the operation. \\ \hline
priorities & \hyperref[sec:model:PriorityMap]{PriorityMap} & yes & The identifiers of the store entries to update and their associated priority values. \\ \hline
\end{tabularx}
\end{table}

\msubsection{struct}{PriorityMap}

An \pref{Object} which maps \pref{StoreEntryID} identifiers to \pref{number} values.

% OrchestrationSimpleStoreRemoveRequest %

\msubsection{struct}{OrchestrationSimpleStoreRemoveRequest}

\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{2.5cm} | p{3cm} | p{2cm} | X |} \hline
\rowcolor{gray!33} Field & Type & Mandatory & Description \\ \hline
ids & \pref{List}$<$\pref{StoreEntryID}$>$ & yes & A list of identifiers of the store entries to remove. \\ \hline
\end{tabularx}
\end{table}

\clearpage

\subsection{Primitives}
\label{sec:model:primitives}

Types and structures mentioned throughout this document that are assumed to be available to implementations of this service.
The concrete interpretations of each of these types and structures must be provided by any IDD document claiming to implement this service.


\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{4.3cm} | X |} \hline
\rowcolor{gray!33} Type & Description \\ \hline
\pdef{DateTime}         & Pinpoints a specific moment in time. \\ \hline
\pdef{ErrorType}        & Any suitable type chosen by the implementor of service. \\ \hline
\pdef{List}$<$A$>$      & An \textit{array} of a known number of items, each having type A. \\ \hline
\pdef{Number}           & Decimal number. \\ \hline
\pdef{Object}           & Set of primitives and possible further objects. \\ \hline
\pdef{OperationStatus}  & Logical, textual or numerical value that indicates whether an operation is a success or a failure. Multiple values can be used for success and error cases to give additional information about the nature of the result. \\ \hline
\pdef{ServiceInstanceID} & A composite string identifier that is intended to be both human and machine-readable. It consists of the instance's provider name, service definition and version, each separated by a special delimiter character. Each part must follow its related naming convention. \\ \hline
\pdef{ServiceName}             & A string identifier that is intended to be both human and machine-readable. Must follow camelCase naming convention. \\ \hline
\pdef{StoreEntryID} & Unique string identifier. \\ \hline
\pdef{String}           & A chain of characters. \\ \hline
\pdef{SystemName}             & A string identifier that is intended to be both human and machine-readable. Must follow PascalCase naming convention. \\ \hline
\end{tabularx}
\end{table}

\newpage

\bibliographystyle{IEEEtran}
\bibliography{bibliography}

\newpage

\section{Revision History}
\subsection{Amendments}

\noindent\begin{tabularx}{\textwidth}{| p{1cm} | p{3cm} | p{2cm} | X | p{4cm} |} \hline
\rowcolor{gray!33} No. & Date & Version & Subject of Amendments & Author \\ \hline

1 & YYYY-MM-DD & \arrowversion & & Xxx Yyy \\ \hline
\end{tabularx}

\subsection{Quality Assurance}

\noindent\begin{tabularx}{\textwidth}{| p{1cm} | p{3cm} | p{2cm} | X |} \hline
\rowcolor{gray!33} No. & Date & Version & Approved by \\ \hline

1 & YYYY-MM-DD & \arrowversion  &  \\ \hline

\end{tabularx}

\end{document}